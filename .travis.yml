language: go

go:
  - 1.4

env:
  - "PATH=/home/travis/gopath/bin:$PATH"
  - secure: "M3h4YbcdrmTvR1x2LdOwkapmt2upJbzz5dVhzIJh5Aoqw61H/yCTS3JUWCxXqIFQ/6RLZmjIbIMJ2VOJ3n2BtbZ6KmC9sLtWhf0C+ZPeHrdkxUXFauJaSKpSHv1qlQgjKXTo18S4386VesSnqbNlsXkFlQumGVhIHP83f6aH9zc="
  - secure: "KoGXm92Hy3YLfaNeksaWzfkgKEpykyDQLKxzJqlo/I+xPZmjFQuZAyQJRCXuGkQho0qazOygyuZ55sKUa57HCD5nLVDxJ5Yi7d6ObYsKCUsK197VCEQrak3/Sf+450+gDjBHFbcX2chFuuUs+uOXTvJ897wd3vhbHGK6Sfy335M="

before_install:
  - go get github.com/mitchellh/gox
  - gox -build-toolchain
  - go get github.com/tcnksm/ghr
  - go get github.com/axw/gocov/gocov
  - go get github.com/mattn/goveralls
  - go get golang.org/x/tools/cmd/cover

script:
  - go test -v -covermode=count -coverprofile=coverage.out ./vsphere
  - goveralls -coverprofile=coverage.out -service=travis-ci -repotoken=$COVERALLS_TOKEN

after_success:
  - gox -output "dist/{{.OS}}_{{.Arch}}_{{.Dir}}"
  - ghr --username rakutentech --token $GITHUB_TOKEN --replace --prerelease --debug pre-release dist/
